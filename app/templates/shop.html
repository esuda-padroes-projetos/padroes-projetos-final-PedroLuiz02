<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vortex Energy</title>
    <link rel="shortcut icon" type="image/x-icon" href="../static/img/logo.png">
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+15&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
    <link rel="stylesheet" href="../static/shop.css">
    <link rel="stylesheet" href="../static/modal.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
</head>


<body>
    <header class="main-header">
        <div class="header-container">
            <div class="logo-container">
                <a href="http://127.0.0.1:5000/" class="logo-link">
                    <img src="../static/img/logo.png" alt="Logo da empresa">
                    <span class="company-name">Vortex</span>
                </a>
            </div>


            <nav>
                <ul class="nav-menu">
                    <li><a href="/#section2">Produtos</a></li>
                    <li><a href="#" class="cart-link">
                            Comprar
                            <i class="fi fi-rr-shopping-cart"></i>
                        </a></li>
                    <li><a href="/sobre">Empresa</a></li>
                </ul>
            </nav>


            {% if current_user.is_authenticated %}
            <div class="user-menu">
                <div class="user-icon" id="userIcon">
                    <i class="fi fi-sr-user"></i>
                </div>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="user-header">
                        <i class="fi fi-sr-user"></i>
                        <div class="user-info">
                            <span>{{current_user.nome.split()[0]}}</span>
                            <a href="#" class="edit-profile">Edit Profile</a>
                        </div>
                        <button class="close-btn" id="closeMenu">
                            <i class="fi fi-sr-cross"></i>
                        </button>
                    </div>
                    <div class="menu-options">
                        <a href="#"><i class="fi fi-sr-settings"></i> Configurações</a>
                        <a href="http://127.0.0.1:5000/logout" id="sair"><i class="fi fi-sr-exit"></i> Sair</a>
                    </div>
                </div>


                <div class="bag-icon" id="bagIcon">
                    <i class="fi fi-rr-basket-shopping-simple"></i>
                </div>
                <div class="dropdown-menu-bag" id="dropdownMenuBag">
                    <div class="bag-header">
                        <i class="fi fi-rr-basket-shopping-simple"></i>
                        <div class="bag-info">
                            <span>{{current_user.nome.split()[0]}}</span>
                        </div>
                        <button class="close-btn-bag" id="closeMenuBag">
                            <i class="fi fi-sr-cross"></i>
                        </button>
                    </div>

                    <div class="bag-options">

                        {% if pedido_aberto %}
                            {% for item in pedido_aberto.itens %}
                            <div class="bag-itens">
                                <div id="lata-bg">
                                    <img src="{{ url_for('static', filename='img/' ~ item.produto.imagem) }}" alt="{{ item.produto.nome }}" id="bag-img">
                                </div>
                                <div id="info-prod">
                                    <h3>{{ item.produto.nome }}</h3>
                                    <span>Unidades: {{ item.quantidade }}</span> 
                                    <br>
                                    <h4>R${{ item.produto.preco_unitario }}</h4>
                                    <h4>Subtotal: R${{ item.quantidade * item.produto.preco_unitario }}</h4>
                                </div>
                                
                                <form action="{{ url_for('deletar_item_route', id_item=item.id_item) }}" method="post">
                                    <button type="submit" class="btn-delete">
                                        <i class="fi fi-rr-trash"></i>
                                    </button>
                                </form>
                            </div>
                            {% endfor %}
                            <div class="bag-total">
                                Total: <span id="bag-total-price">R$ {{ total_pedido }}</span>
                            </div>
                        {% else %}
                            <p>Seu carrinho está vazio.</p>
                        {% endif %}

                        <button id="bag-buy-btn" onclick="openModal('meuModal')">
                            <a href="#">Finalizar Compra</a>
                        </button>

                    </div>
                </div>
            </div>

            {% else %}
            <div class="user-menu">
                <div class="user-icon" id="userIcon">
                    <a href="http://127.0.0.1:5000/login" style="text-decoration: none; color: inherit;"><i class="fi fi-sr-user"></i></a>
                </div>
            {% endif %}
            </div>
    </header>

    <div class="modal" id="meuModal">

        <div class="modal-overlay"></div>
        <article class="modal-content">
            <main class="confirm-main">
                <h1 class="confirm-title">Confirmar Compra</h1>

                <section class="confirm-grid">
                    <aside class="order-summary">
                        <h3 class="summary-title">Resumo do Pedido</h3>

                        <section class="products-list">
                            {% for item in pedido_aberto.itens %}
                            <article class="order-product" data-id="{{ item.id_item }}">

                                <header class="product-left">
                                    <img src="{{ url_for('static', filename='img/' ~ item.produto.imagem) }}" alt="{{ item.produto.nome }}">
                                    <div class="product-texts">
                                        <h4>{{ item.produto.nome }}</h4>
                                    </div>
                                </header>
                                
                                <footer class="product-right">
                                    <h3 class="units">Unidades: {{ item.quantidade }}</h3>
                                    <span class="unit">R$ {{ item.produto.preco_unitario }}</span>
                                    <div class="qty-row">
                                        <button class="qty-minus" type="button">−</button>
                                        <input 
                                            type="number" 
                                            class="qty-input" 
                                            value="{{ item.quantidade }}" 
                                            min="1">
                                        <button class="qty-plus" type="button">+</button>
                                    </div>
                                    <form action="{{ url_for('deletar_item_route', id_item=item.id_item) }}" method="post">
                                        <button type="submit" class="btn-delete" id="del_btn">
                                            <i class="fi fi-rr-trash"></i>
                                        </button>
                                    </form>
                                </footer>
    
                            </article>
                            {% endfor %}
                        </section>
           
                        <div class="order-total-fixed">
                            <h3>Total</h3>
                            <strong id="totalPrice">R$ {{ total_pedido }}</strong>
                        </div>
                    </aside>
    
                    <section class="form-section">
                        <form id="confirmForm" novalidate>
                            <fieldset class="field">
                                <legend>Dados do comprador</legend>
                                <div class="form-group">
                                    <label for="fullName">Nome completo</label>
                                    <input id="fullName" type="text" required>
                                </div>
    
                                <div class="form-group">
                                    <label for="email">E-mail</label>
                                    <input id="email" type="email" required>
                                </div>

                                <div class="form-group">
                                    <label for="cep">CEP</label>
                                    <input id="cep" type="text" maxlength="8" value="" required onblur="pesquisacep(this.value);">
                                </div>
    
                                <div class="form-group">
                                    <div>
                                        <label for="rua">Rua</label>
                                        <input id="rua" type="text" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div>
                                        <label for="bairro">Bairro</label>
                                        <input id="bairro" type="text" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div>
                                        <label for="cidade">Cidade</label>
                                        <input id="cidade" type="text" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div>
                                        <label for="uf">Estado</label>
                                        <input id="uf" type="text" required>
                                    </div>
                                </div>
    
                                <div class="form-group">
                                    <label for="payment">Forma de pagamento</label>
                                    <select id="payment" required>
                                        <option value="">Selecione...</option>
                                        <option value="credit">Cartão de Crédito</option>
                                        <option value="debit">Cartão de Débito</option>
                                        <option value="pix">PIX</option>
                                    </select>
                                </div>
    
                                <div class="buttons-row">
                                    <button type="submit" class="confirm-button buy-button">Confirmar compra</button>
                                    <a href="/shop" class="buy-button back-button">Voltar</a>
                                </div>
    
                            </fieldset>
                        </form>
                    </section>
    
                </section>
            </main>
    
        </article>
    
    </div>


    <main>
        <section class="section-1">
            {% for produto in produtos %}
            <div class="product-card">
                <img src="{{ url_for('static', filename='img/' ~ produto.imagem) }}" alt="{{ produto.nome }}">
                
                <h3>{{ produto.nome }}</h3>
                <p class="price">R$ {{ produto.preco_unitario }}</p>
                <p class="description">{{ produto.descricao }}</p>
                
                <button class="buy-btn">
                    <a href="{{ url_for('product', id=produto.id_produto) }}">Comprar</a>
                </button>
            </div>
            {% endfor %}
        </section>
    </main>


    <footer>
        <div class="footer-container">
            <div class="footer-column">
                <h3>Use cases</h3>
                <ul>
                    <li><a href="#">UI design</a></li>
                    <li><a href="#">UX design</a></li>
                    <li><a href="#">Wireframing</a></li>
                    <li><a href="#">Diagramming</a></li>
                    <li><a href="#">Brainstorming</a></li>
                    <li><a href="#">Online whiteboard</a></li>
                    <li><a href="#">Team collaboration</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3>Explore</h3>
                <ul>
                    <li><a href="#">Design</a></li>
                    <li><a href="#">Prototyping</a></li>
                    <li><a href="#">Development features</a></li>
                    <li><a href="#">Design systems</a></li>
                    <li><a href="#">Collaboration features</a></li>
                    <li><a href="#">Design process</a></li>
                    <li><a href="#">FigJam</a></li>
                </ul>
            </div>


            <div class="footer-column">
                <h3>Resources</h3>
                <ul>
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">Best practices</a></li>
                    <li><a href="#">Colors</a></li>
                    <li><a href="#">Color wheel</a></li>
                    <li><a href="#">Support</a></li>
                    <li><a href="#">Developers</a></li>
                    <li><a href="#">Resource library</a></li>
                </ul>
            </div>


            <div class="footer-social">
                <a href="#"><i class="fi fi-brands-twitter"></i></a>
                <a href="#"><i class="fi fi-brands-instagram"></i></a>
                <a href="#"><i class="fi fi-brands-youtube"></i></a>
                <a href="#"><i class="fi fi-brands-linkedin"></i></a>
            </div>
        </div>
    </footer>
    <script src="../static/script.js"></script>
    <script src="../static/modal.js"></script>
    <script src="../static/cep.js"></script>
</body>

</html>